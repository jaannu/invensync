<!DOCTYPE html>
<html>
  <head>
    <title>InvenSync AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.0.1/aframe/build/aframe-ar.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
      #binSelector {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        background-color: rgba(255, 255, 255, 0.85);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 16px;
        font-family: Arial, sans-serif;
        box-shadow: 0 0 8px rgba(0,0,0,0.2);
      }
    </style>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <!-- Bin dropdown selector -->
    <div id="binSelector">
      <label for="bin">Select Bin: </label>
      <select id="bin">
        <option value="Bin A">Bin A</option>
        <option value="Bin B">Bin B</option>
        <option value="Bin C">Bin C</option>
      </select>
    </div>

    <a-scene embedded arjs>
      <!-- Custom marker -->
      <a-marker type="pattern" url="pattern-logo.patt" id="binMarker">
        <a-box position="0 0.5 0" material="color: grey;"></a-box>
       <a-text
  id="binLabel"
  value="Loading..."
  position="0 1.01 0"
  rotation="-90 0 0"
  align="center"
  color="black"
  scale="1.5 1.5 1">
</a-text>

      </a-marker>

      <!-- Grey grid background as plane -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#d3d3d3" shadow></a-plane>
      
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyBV9mhdIDzxIhnodIB-NCzYZvsIcfQBruQ",
        authDomain: "invensync-551a4.firebaseapp.com",
        databaseURL: "https://invensync-551a4-default-rtdb.firebaseio.com",
        projectId: "invensync-551a4",
        storageBucket: "invensync-551a4.appspot.com",
        messagingSenderId: "295889603496",
        appId: "1:295889603496:web:adf57cc10a87461b462b9d"
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const label = document.getElementById("binLabel");
      const binSelect = document.getElementById("bin");

      let currentRef = null;

      function listenToBin(binName) {
        if (currentRef) currentRef.off(); // remove previous listener
        currentRef = db.ref(`bins/${binName}`);
        currentRef.on("value", snapshot => {
          const data = snapshot.val();
          if (data && data.qty !== undefined) {
            label.setAttribute("value", `${binName}: ${data.qty} pcs`);
          } else {
            label.setAttribute("value", `${binName}: No data`);
          }
        });
      }

      // Initial bin
      listenToBin(binSelect.value);

      // On dropdown change
      binSelect.addEventListener("change", () => {
        listenToBin(binSelect.value);
      });
    </script>
  </body>
</html>
